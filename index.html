<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>New Year Countdown</title>
  <style>
    /* Base */
    html, body { height: 100%; }
    body {
      margin: 0;
      background: #000;
      color: #fff;
      font-family: Arial, sans-serif;
      text-align: center;
      cursor: none; /* hide default cursor so our custom one shows */
    }
    .wrap { height: 100vh; display: flex; flex-direction: column; justify-content: center; align-items: center; }
    h1 { font-size: 3.2em; margin: 0.4em 0; }
    .controls { margin-top: 16px; }
    button { margin: 6px; padding: 10px 18px; font-size: 1em; cursor: pointer; border: 1px solid #666; background: #111; color: #fff; }
    video { display: none; }
    #timer { text-shadow: 0 0 12px rgba(255,255,255,0.25); }

    /* Worm mode */
    @keyframes wormPulse { 0%,100% { filter: url(#wormFilter); } }
    .worm-on #timer { animation: wormPulse 10s linear infinite; }

    /* Custom cursor */
    .cursor {
      position: fixed;
      top: 0; left: 0;
      width: 18px; height: 18px;
      border-radius: 50%;
      transform: translate(-50%, -50%);
      background: #fff;
      box-shadow: 0 0 12px rgba(255,255,255,0.6);
      mix-blend-mode: screen;
      pointer-events: none;
      z-index: 9999;
    }

    /* Trail dots */
    .trail-dot {
      position: fixed;
      width: 10px; height: 10px;
      border-radius: 50%;
      transform: translate(-50%, -50%);
      pointer-events: none;
      mix-blend-mode: screen;
      animation: trailFade 500ms ease-out forwards;
      z-index: 9998;
    }
    @keyframes trailFade {
      0%   { opacity: 1; transform: translate(-50%, -50%) scale(1); filter: blur(0px); }
      100% { opacity: 0; transform: translate(-50%, -50%) scale(0.6); filter: blur(2px); }
    }

    /* Fallback: show default cursor on touch devices */
    @media (hover: none) and (pointer: coarse) {
      body { cursor: default; }
      .cursor { display: none; }
    }
  </style>
</head>
<body>
  <!-- SVG filter: displacement for worm mode -->
  <svg width="0" height="0" style="position:absolute">
    <filter id="wormFilter">
      <feTurbulence type="fractalNoise" baseFrequency="0.01" numOctaves="2" seed="2" result="noise"/>
      <feDisplacementMap in="SourceGraphic" in2="noise" scale="12" xChannelSelector="R" yChannelSelector="G"/>
    </filter>
  </svg>

  <div class="wrap" id="root">
    <h1 id="timer">Loading‚Ä¶</h1>

    <div class="controls">
      <button id="record">Start recording</button>
      <button id="stop">Stop & download</button>
      <button id="worm">Toggle worm mode</button>
    </div>

    <video id="preview" autoplay muted></video>
    <p style="color:#aaa; font-size:0.9em; max-width:560px; margin-top:10px;">
      Tip: For manual worm effect in window capture, press ‚ÄúStart recording‚Äù, choose ‚ÄúNew Year Countdown‚Äù, then slowly scroll and move your cursor left/right.
    </p>
  </div>

  <!-- Custom cursor element -->
  <div class="cursor" id="cursor"></div>

  <script>
    // Countdown: Jan 1, 2026 at midnight PST
    const target = new Date("January 1, 2026 00:00:00 PST").getTime();
    function updateCountdown() {
      const now = Date.now();
      const distance = target - now;
      const days = Math.floor(distance / (1000 * 60 * 60 * 24));
      const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
      const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
      const seconds = Math.floor((distance % (1000 * 60)) / 1000);
      const el = document.getElementById("timer");
      el.textContent = distance >= 0
        ? `${days}d ${hours}h ${minutes}m ${seconds}s`
        : "üéâ Happy New Year!";
    }
    setInterval(updateCountdown, 1000);
    updateCountdown();

    // Recording via MediaRecorder (window capture)
    let recorder, stream;
    document.getElementById("record").onclick = async () => {
      stream = await navigator.mediaDevices.getDisplayMedia({ video: true, audio: false });
      document.getElementById("preview").style.display = "none";
      recorder = new MediaRecorder(stream, { mimeType: "video/webm;codecs=vp9" });
      const chunks = [];
      recorder.ondataavailable = e => e.data.size && chunks.push(e.data);
      recorder.onstop = () => {
        const blob = new Blob(chunks, { type: "video/webm" });
        const url = URL.createObjectURL(blob);
        const a = document.createElement("a");
        a.href = url;
        a.download = "countdown.webm";
        document.body.appendChild(a);
        a.click();
        URL.revokeObjectURL(url);
        a.remove();
      };
      recorder.start();
    };
    document.getElementById("stop").onclick = () => {
      if (recorder && recorder.state !== "inactive") recorder.stop();
      if (stream) stream.getTracks().forEach(t => t.stop());
    };

    // Worm toggle
    const root = document.getElementById("root");
    document.getElementById("worm").onclick = () => {
      root.classList.toggle("worm-on");
    };

    // Rainbow cursor + trail
    const cursor = document.getElementById("cursor");
    let mouseX = window.innerWidth / 2;
    let mouseY = window.innerHeight / 2;
    let cx = mouseX, cy = mouseY;
    let currentColor = 'hsl(0, 100%, 65%)';

    // Smooth follow via RAF
    function animateCursor() {
      const lerp = 0.25; // smoothing factor
      cx += (mouseX - cx) * lerp;
      cy += (mouseY - cy) * lerp;
      cursor.style.transform = `translate(${cx - 9}px, ${cy - 9}px)`; // center 18px circle

      requestAnimationFrame(animateCursor);
    }
    requestAnimationFrame(animateCursor);

    // Update target position on move, drop trail dot
    const maxDots = 120; // safety cap
    let dotCount = 0;
    window.addEventListener('mousemove', (e) => {
      mouseX = e.clientX;
      mouseY = e.clientY;

      // Trail dot
      const dot = document.createElement('div');
      dot.className = 'trail-dot';
      dot.style.left = `${mouseX}px`;
      dot.style.top = `${mouseY}px`;
      dot.style.background = currentColor;
      dot.style.boxShadow = `0 0 10px ${currentColor}`;
      document.body.appendChild(dot);
      dotCount++;

      dot.addEventListener('animationend', () => {
        dot.remove();
        dotCount--;
      });

      // Prevent runaway dot accumulation
      if (dotCount > maxDots) {
        const oldDots = document.querySelectorAll('.trail-dot');
        for (let i = 0; i < oldDots.length - maxDots; i++) {
          oldDots[i].remove();
          dotCount--;
        }
      }
    });

    // Change cursor color every 0.25s (random hue)
    setInterval(() => {
      const hue = Math.floor(Math.random() * 360);
      currentColor = `hsl(${hue}, 100%, 65%)`;
      cursor.style.background = currentColor;
      cursor.style.boxShadow = `0 0 12px ${currentColor}`;
    }, 250);

    // Also skew the timer a bit with mouse for organic motion (optional)
    window.addEventListener("mousemove", (e) => {
      const center = window.innerWidth / 2;
      const delta = (e.clientX - center) / center; // -1..1
      document.getElementById("timer").style.transform = `skewX(${delta * 3}deg) translateX(${delta * 10}px)`;
    });
  </script>
</body>
</html>
